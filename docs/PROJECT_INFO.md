# 隐私红包dApp产品需求文档

## 一、产品概述

### 1.1 产品简介
隐私红包dApp是一款基于区块链的隐私保护红包应用，利用全同态加密技术确保红包密码和金额分配的完全隐私性。用户可创建两种类型的红包（随机红包/平均红包），领取者需输入正确密码方可领取。

### 1.2 核心价值主张
- **绝对隐私保护**：红包密码和随机金额在链上加密存储，永不泄露
- **去中心化运作**：不依赖任何中心化服务器，抗审查
- **灵活红包类型**：支持随机红包和平均分配红包
- **安全可靠**：基于密码学保障资金安全

## 二、用户角色

### 2.1 红包创建者
- 创建并发放红包
- 设置红包参数（类型、金额、数量、密码）
- 查看自己创建的红包状态
- 收回过期未领红包

### 2.2 红包领取者
- 查看可领取的红包列表
- 输入密码尝试领取红包
- 查看领取历史和收益
- 分享红包给他人

## 三、功能需求

### 3.1 红包创建模块

#### 3.1.1 创建入口
- 用户点击"创建红包"按钮
- 选择红包类型：随机红包 或 平均红包
- 连接钱包并确认身份

#### 3.1.2 参数设置
**通用参数（两种红包类型均需设置）：**
- 红包总金额（ETH或ERC20代币）
- 红包密码（6-16位字符，创建时设置）
- 红包份数（1-100份）
- 过期时间（1小时 - 30天）
- 领取条件（可选）：
  - 仅限特定地址领取
  - 需持有特定NFT
  - 需完成特定任务

**随机红包特有参数：**
- 每份金额随机分配
- 总金额固定，各份金额随机生成
- 先到先得，领完即止

**平均红包特有参数：**
- 每份金额平均分配
- 每人限领一份
- 可设置最多领取人数

#### 3.1.3 创建确认
- 预览红包信息（隐藏敏感数据）
- 确认Gas费用
- 签署交易
- 生成红包分享链接和红包ID

### 3.2 红包领取模块

#### 3.2.1 红包发现
- 通过分享链接访问红包
- 输入红包ID搜索
- 浏览公共红包列表（不显示密码相关隐私信息）

#### 3.2.2 密码输入与验证
- 领取者输入密码尝试领取
- 系统在本地加密密码后提交验证（推荐：前端对密码做 salt+哈希，salt 由合约发布的领取会话随机数提供，防止重放；链上仅存哈希）
- 密码尝试限制与冷却：
  - 默认最多 5 次/地址/红包，失败触发 60s 冷却；连续失败超过阈值可延长冷却
  - 错误计数存储在合约，防止刷新页面绕过
- 实时反馈验证结果：
  - 密码正确 → 进入领取流程
  - 密码错误 → 提示重试（有限次数）
  - 红包已领完 → 提示结束
  - 红包过期 → 提示失效

#### 3.2.3 领取流程
**随机红包领取：**
1. 密码验证通过
2. 系统随机分配金额（用户领取时才知道具体金额；随机性建议使用链上 VRF 或区块哈希+提交-揭示方案，避免创建者操控）
3. 确认领取金额
4. 签署交易领取

**平均红包领取：**
1. 密码验证通过
2. 显示平均金额
3. 确认领取
4. 签署交易领取

### 3.3 红包管理模块

#### 3.3.1 创建者管理面板
- 查看已创建红包列表
- 每个红包的实时状态：
  - 已领取份数/总份数
  - 剩余金额
  - 领取记录（时间、地址、金额）
  - 过期倒计时
- 提前结束红包功能
- 收回过期未领资金（过期后由任意人可触发退款交易；若无人触发则下次有人交互时顺带结算，确保资金可回收）

#### 3.3.2 领取者管理面板
- 可领取红包列表
- 已领取红包历史
- 总收益统计
- 失败领取记录

### 3.4 红包分享模块

#### 3.4.1 分享方式
- 生成专属分享链接
- 二维码生成
- 社交媒体分享（Twitter、Telegram、Discord等）
- 密码分享提示（通过安全渠道分享密码）

#### 3.4.2 分享内容
- 红包类型图标
- 总金额（可选隐藏）
- 红包份数
- 过期时间
- 领取条件说明
- 红包ID
- 安全提醒：勿在公开渠道分享密码

## 四、红包类型详细说明

### 4.1 随机红包（拼手气红包）

#### 4.1.1 特性
- 总金额固定，份数固定
- 每份金额随机分配（建议使用链上可验证随机源；若使用链下生成需提交承诺并在领取时揭示，配合超时惩罚）
- 先到先得，领完即止
- 领取者领取时才知道具体金额

#### 4.1.2 使用场景
- 节日祝福
- 社区活动
- 游戏奖励
- 惊喜礼物

#### 4.1.3 用户流程
```
创建者：设置总金额100 USDC，10份 → 系统随机分配金额（如：3, 12, 8, 15...总和100）
领取者A：领取 → 获得12 USDC
领取者B：领取 → 获得8 USDC
...直到10份全部领完
```

### 4.2 平均红包（普通红包）

#### 4.2.1 特性
- 总金额固定，份数固定
- 每份金额平均分配
- 每人限领一份
- 可设置最多领取人数

#### 4.2.2 使用场景
- 团队奖励
- 活动参与奖
- 会员福利
- 平均分配奖金

#### 4.2.3 用户流程
```
创建者：设置总金额100 USDC，10份 → 每份固定10 USDC
领取者A：领取 → 获得10 USDC
领取者B：领取 → 获得10 USDC
...最多10人领取
```

## 五、用户体验需求

### 5.1 界面设计要求
- **红包主题**：红色为主色调，喜庆氛围
- **状态可视化**：
  - 未领取：红包图标完整
  - 已领取：红包图标打开
  - 已过期：红包图标灰色
- **进度展示**：已领取份数/总份数的进度条
- **金额显示**：
  - 创建者：显示总金额和分配规则
  - 领取者：领取前只显示"神秘金额"，领取后显示具体金额

### 5.2 交互流程要求
- **简化操作**：钱包连接后一键创建
- **清晰引导**：新手引导和操作提示
- **实时反馈**：交易状态实时更新（前端监听合约事件或轮询；若超时需提示重试/加速）
- **错误处理**：友好的错误提示和解决方案
- **网络切换容错**：领取或创建前自动提示切换目标链；用户拒绝或钱包不支持时，提供手动 RPC 添加指引和重试按钮
- **分享安全**：分享链接仅包含红包 ID，不包含密码；推荐提供一次性口令或生成有效期短链接的选项

### 5.3 移动端适配
- 响应式设计，支持手机浏览器
- 触摸友好的交互元素
- 移动端专属分享功能

## 六、安全与隐私需求

### 6.1 密码安全
- 密码仅在用户本地加密
- 链上只存储加密后的密码
- 密码验证通过加密计算完成，永不泄露明文

### 6.2 资金安全
- 智能合约托管资金，创建者无法中途撤回
- 领取者需密码验证才能领取
- 过期自动退回机制（过期后可由任何人触发退款；领取时若检测到过期则顺带退款，避免资金锁定）

### 6.3 隐私保护
- 领取记录可选匿名显示
- 红包详情对非相关人员部分隐藏
- 不收集用户个人信息

### 6.4 防滥用机制
- 单地址领取次数限制
- 密码尝试次数限制
- 大额红包额外确认
- 一人一份防刷：平均红包在合约层限制同一地址重复领取；可选启用基于签名的白名单或持有特定 NFT/任务完成的校验，减缓女巫攻击
- 速率限制：对同一地址的领取和创建调用增加最小时间间隔或递增手续费，降低暴力尝试频率

## 七、数据展示需求

### 7.1 公共数据展示
- 红包创建总数
- 总发放金额
- 热门红包排行
- 最新创建红包

### 7.2 个人数据统计
- 创建红包数量及总金额
- 领取红包数量及总金额
- 成功率（创建红包被领取比例）
- 历史记录时间线

### 7.3 实时状态显示
- 红包剩余份数实时更新
- 倒计时显示
- 最近领取记录滚动

## 八、运营与推广需求

### 8.1 社交功能
- 红包排行榜
- 成就系统（如：红包达人、幸运之星）
- 分享奖励机制

### 8.2 活动支持
- 节假日主题红包模板
- 活动专属红包类型
- 合作项目联合红包

### 8.3 推广工具
- 邀请奖励计划
- 社交媒体分享奖励
- 社区建设红包

## 九、多链支持需求

### 9.1 支持的网络
- **主网**：Ethereum Mainnet
- **Layer2**：Polygon, Arbitrum, Optimism, Base
- **其他EVM链**：BNB Chain, Avalanche

### 9.2 跨链功能
- 创建者选择目标链
- 领取者自动切换对应网络
- 多链资产支持

## 十、合规与风控

### 10.1 合规要求
- 遵守目标链所在地法律法规
- 反洗钱（AML）基础措施
- 大额交易监控提示

### 10.2 风控机制
- 单日创建金额上限
- 单日领取次数限制
- 可疑行为监控

### 10.3 用户教育
- 安全使用指南
- 密码保管提示
- 防诈骗提醒

---

## 文档版本信息
- **版本**：v1.0
- **更新日期**：2024年1月
- **适用对象**：产品经理、设计师、开发团队、运营团队

## 技术文档
https://docs.zama.org/protocol/relayer-sdk-guides